on: [push]

jobs:
  dbt_build:
    runs-on: ubuntu-20.04
    environment: 
      name: Dev
      
    env:
      LAMBDA: ${{ matrix.lambdas }}
      COMMAND: "{\\\"commands\\\": [\\\"--version\\\"]}"
      DATA_WRANGLER: awswrangler-layer-2.9.0-py3.8
      JSONREF: jsonref-0.2

    steps:
    - uses: actions/checkout@v2
    
    - name: zip and push lambdas
      run: |
        wget https://files.pythonhosted.org/packages/b3/cf/93d4f34d76863d4fb995cb8e3e4f29908304065ce6381e0349700c44ad0c/${{ env.JSONREF }}.tar.gz

        echo "Extracting ${{ env.JSONREF }}.tar.gz"
        tar xzf ${{ env.JSONREF }}.tar.gz
        mkdir -p "jsonref/python/lib/python3.8/site-packages/${{ env.JSONREF }}/"

        echo "Pushing ${{ env.JSONREF }}.zip to s3"

    - name: create zip
      run: |
        echo "Creating python path"
        mv "${{ env.JSONREF }}/*" "jsonref/python/lib/python3.8/site-packages/${{ env.JSONREF }}/"
        tree "jsonref"

        echo "Zipping ${{ env.JSONREF }}.zip"
        7z a -tzip "${{ env.JSONREF }}.zip" jsonref
  
