on: [push]

jobs:
  dbt_build:
    runs-on: ubuntu-20.04
    environment: 
      name: Dev
      
    env:
      LAMBDA: ${{ matrix.lambdas }}
      COMMAND: "{\\\"commands\\\": [\\\"--version\\\"]}"
      DATA_WRANGLER: awswrangler-layer-2.9.0-py3.8
      JSONREF: jsonref-0.2

    steps:
    - uses: actions/checkout@v2
    
    - name: install checkov
      run: pip3 install checkov
    
    - name: run checkov
      run: |
        CHECKOV_RESULTS=$(checkov -d infrastructure --quiet --compact --soft-fail)
        echo $CHECKOV_RESULTS | grep FAILED || success=true
        if [ $success ]; then
          echo "::success"
        else
          echo $CHECKOV_RESULTS
          echo "::warning"
        fi
      
